/**
 * cxValidation
 * @version 1.3.0
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxValidation
 * @license Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).cxValidation=t()}(this,(function(){"use strict";const e={validMessage:{titleSymbol:{before:"【",after:"】"},required:{input:"未填写",radio:"未选择",checkbox:"未勾选",select:"未选择"},groupRequired:{input:"至少填写 {{1}} 项",radio:"未选择",checkbox:"至少选择 {{1}} 项"},condRequired:{input:"未填写",radio:"未选择",checkbox:"未勾选",select:"未选择"},equals:"两次输入内容不一致",minSize:"最少 {{0}} 个字符",maxSize:"最多 {{0}} 个字符",min:"最小值为 {{0}}",max:"最大值为 {{0}}",integer:"无效的整数",number:"无效的数值",onlyNumber:"只能填写数字",onlyNumberSp:"只能填写数字和空格",onlyLetter:"只能填写英文字母",onlyLetterSp:"只能填写英文字母和空格",onlyLetterNumber:"只能填写英文字母与数字",onlyLetterNumberSp:"只能填写英文字母、数字、空格",email:"无效的邮件地址",phone:"无效的电话号码",url:"无效的网址",chinese:"只能填写中文汉字",chinaId:"无效的身份证号码",chinaIdLoose:"无效的身份证号码",chinaZip:"无效的邮政编码",qq:"无效的 QQ 号码"},result:{status:!0},vid:1,formFuns:{},groupCache:{},isElement:function(e){return!(!e||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(e instanceof HTMLElement))||!(!e||!e.nodeType||1!==e.nodeType)},isHidden:function(e){if(this.isElement(e)){const t=window.getComputedStyle(e);return"none"===t.getPropertyValue("display")||"hidden"===t.getPropertyValue("visibility")||0==t.getPropertyValue("opacity")||0==t.getPropertyValue("width")&&0==t.getPropertyValue("height")}return!0},isVisible:function(e){return!this.isHidden(e)},init:function(){const e=this;e.defaults={success:e=>{e.form.submit()},error:t=>{const u=t.element.nodeName.toLowerCase();"required"===t.rule||"condRequired"===t.rule?"input"===u&&["radio","checkbox","color","range","file","hidden"].indexOf(t.element.type)>=0?e.toMessage(t.message):e.toFocus(t.element):e.toMessage(t.message)}}}};e.validFun={required:function(e){return"checkbox"===e.type||"radio"===e.type?!!e.checked:!!e.value.trim().length},groupRequired:function(e,t,u){const n=this;return t=String(t),u=parseInt(u,10),isNaN(u)&&(u=1),void 0!==n.groupCache[t]&&void 0!==n.groupCache[t].count||(n.groupCache[t]={count:u}),n.groupCache[t].count>0&&(n.validFun.required(e)?n.groupCache[t].count-=1:void 0===n.groupCache[t].element&&(n.groupCache[t].element=e)),!0},condRequired:function(e,t,u){const n=this;let a=!1,i=!0;if("string"==typeof t&&t.length){if(t.indexOf(",")>0){if(t=t.split(","),Array.isArray(t)&&t.length){a=!0;for(let e of t)if(!n.validFun.required(document.getElementById(e))){a=!1;break}}}else"string"==typeof u?document.getElementById(t).value===u&&(a=!0):n.validFun.required(document.getElementById(t))&&(a=!0);a&&(i=n.validFun.required(e))}return i},equals:function(e,t){return e.value==document.getElementById(t).value},minSize:function(e,t){return!e.value.length||e.value.length>=t},maxSize:function(e,t){return!e.value.length||e.value.length<=t},min:function(e,t){return!e.value.length||parseFloat(e.value)>=t},max:function(e,t){return!e.value.length||parseFloat(e.value)<=t},integer:function(e){return!e.value.length||/^[\-\+]?\d+$/.test(e.value)},number:function(e){return!e.value.length||/^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/.test(e.value)},onlyNumber:function(e){return!e.value.length||/^[0-9]+$/.test(e.value)},onlyNumberSp:function(e){return!e.value.length||/^[0-9\ ]+$/.test(e.value)},onlyLetter:function(e){return!e.value.length||/^[a-zA-Z]+$/.test(e.value)},onlyLetterSp:function(e){return!e.value.length||/^[a-zA-Z\ ]+$/.test(e.value)},onlyLetterNumber:function(e){return!e.value.length||/^[0-9a-zA-Z]+$/.test(e.value)},onlyLetterNumberSp:function(e){return!e.value.length||/^[0-9a-zA-Z\ ]+$/.test(e.value)},email:function(e){return!e.value.length||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e.value)},phone:function(e){return!e.value.length||/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/.test(e.value)},url:function(e){return!e.value.length||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e.value)},chinese:function(e){return!e.value.length||/^[\u4E00-\u9FA5]+$/.test(e.value)},chinaId:function(e){return!e.value.length||/^[1-9]\d{5}[1-9]\d{3}(((0[13578]|1[02])(0[1-9]|[12]\d|3[0-1]))|((0[469]|11)(0[1-9]|[12]\d|30))|(02(0[1-9]|[12]\d)))(\d{4}|\d{3}[xX])$/.test(e.value)},chinaIdLoose:function(e){return!e.value.length||/^(\d{18}|\d{15}|\d{17}[xX])$/.test(e.value)},chinaZip:function(e){return!e.value.length||/^\d{6}$/.test(e.value)},qq:function(e){return!e.value.length||/^[1-9]\d{4,10}$/.test(e.value)},call:function(){const e=Array.prototype.slice.call(arguments);let t=e.splice(1,1),u=window;if(t.indexOf(".")>=0)for(t=t.split(".");t.length;)u=u[t.shift()];else u=u[t];return"function"!=typeof u||u.apply(u,e)}},e.getRuleArguments=function(e,t){const u=e.dataset.validation;let n=[],a=[];if("string"==typeof u&&u.length&&(n=u.replace(/\s|\[[^\]]*\]/g,"").split(",")),"string"==typeof t&&t.length&&n.indexOf(t)>=0){let e=u.match(new RegExp(t+"((\\[[^\\]]+\\])+)"));Array.isArray(e)&&e.length>1&&(a=e[1].match(/([^\[\]]+)/g),Array.isArray(a)&&1===a.length&&"groupRequired"===t&&(a[1]=1))}return a},e.getMessage=function(e,t){const u=this,n=e.nodeName.toLowerCase();let a="";if("string"==typeof e.dataset.validationMessage&&e.dataset.validationMessage.length)try{a=JSON.parse(e.dataset.validationMessage),"string"==typeof a[t]&&a[t].length&&(a=a[t])}catch(t){a=e.dataset.validationMessage}else"string"!=typeof u.validMessage[t]&&"object"!=typeof u.validMessage[t]||("string"==typeof u.validMessage[t]?a=u.validMessage[t]:"input"===n?"radio"===e.type&&"string"==typeof u.validMessage[t].radio?a=u.validMessage[t].radio:"checkbox"===e.type&&"string"==typeof u.validMessage[t].checkbox?a=u.validMessage[t].checkbox:"string"==typeof u.validMessage[t].input&&(a=u.validMessage[t].input):"select"===n&&"string"==typeof u.validMessage[t].select?a=u.validMessage[t].select:"string"==typeof u.validMessage[t].input&&(a=u.validMessage[t].input),a.length&&"string"==typeof e.dataset.validationTitle&&e.dataset.validationTitle.length&&(a=u.validMessage.titleSymbol.before+e.dataset.validationTitle+u.validMessage.titleSymbol.after+a));if(a.length){let n=u.getRuleArguments(e,t);for(var i=0,s=n.length;i<s;i++)a=a.replace(new RegExp("\\{\\{"+i+"\\}\\}"),n[i])}return a},e.validItem=function(e,t){const u=this;let n=Object.assign({},u.result);const a=e.dataset.validation;if(t=Object.assign({},t),"string"==typeof a&&a.length){let t=a.replace(/\s|\[[^\]]*\]/g,"").split(",");for(let i of t)if("function"==typeof u.validFun[i]){let t=a.match(new RegExp(i+"((\\[[^\\]]+\\])+)")),s=[e];if(Array.isArray(t)&&t.length>1&&(s=s.concat(t[1].match(/([^\[\]]+)/g))),n=u.validFun[i].apply(u,s),"boolean"==typeof n&&(n={status:n}),"object"==typeof n&&"boolean"==typeof n.status&&!1===n.status){n.rule=i,"string"==typeof n.message&&n.message.length||(n.message=u.getMessage(e,i));break}}}return n.element=e,"function"==typeof t.complete&&t.complete(n),!0===n.status&&"function"==typeof t.success?t.success(n):!1===n.status&&"function"==typeof t.error&&t.error(n),n},e.validForm=function(e,t){const u=this,n=Object.assign({},u.result);let a=e.querySelectorAll("input,textarea,select");t=Object.assign({},t),u.groupCache={};for(let e of a){const t=u.validItem(e);if(t&&!1===t.status){n.status=!1,n.element=e,"string"==typeof t.rule&&t.rule.length&&(n.rule=t.rule),"string"==typeof t.message&&t.message.length&&(n.message=t.message);break}}if(n&&!0===n.status)for(let e in u.groupCache)if(u.groupCache[e].count>0){n.status=!1,n.rule="groupRequired",n.element=u.groupCache[e].element,n.message=u.getMessage(n.element,n.rule);break}return n.form=e,u.groupCache={},"function"==typeof t.complete&&t.complete(n),!0===n.status&&"function"==typeof t.success?t.success(n):!1===n.status&&"function"==typeof t.error&&t.error(n),n},e.formSubmitFn=function(e,t){event.preventDefault(),this.validForm(e,Object.assign({},this.defaults,t))},e.toMessage=function(e){alert(e)},e.toFocus=function(e){this.isVisible(e)&&e.focus()},e.init();const t=function(){return t.valid.apply(t,arguments)};return t.setOptions=function(t){Object.assign(e.defaults,t)},t.setLanguage=function(t){for(let u in t)"object"==typeof t[u]?e.validMessage.hasOwnProperty(u)?Object.assign(e.validMessage[u],t[u]):e.validMessage[u]=Object.assign({},t[u]):e.validMessage[u]=t[u]},t.setRules=function(t){for(let u in t)"function"==typeof t[u]&&(e.validFun[u]=t[u].bind())},t.valid=function(t,u){if(e.isElement(t))return"form"===t.nodeName.toLowerCase()?e.validForm(t,u):e.validItem(t,u)},t.verify=function(t,u){this.valid(t,Object.assign({},e.defaults,u))},t.attach=function(){let t,u={};for(let n of arguments)e.isElement(n)?t=n:"object"==typeof n&&Object.assign(u,n);if(!e.isElement(t)||!t.nodeName||"form"!==t.nodeName.toLowerCase())return void console.warn("[cxValidation] Not form element.");let n=t.dataset.cxVid;"function"!=typeof e.formFuns[n]?(n="cxValid_"+e.vid,t.dataset.cxVid=n,e.vid++):t.removeEventListener("submit",e.formFuns[n]),e.formFuns[n]=e.formSubmitFn.bind(e,t,u),t.addEventListener("submit",e.formFuns[n])},t.detach=function(t){if(!e.isElement(t)||!t.nodeName||"form"!==t.nodeName.toLowerCase())return;let u=t.dataset.cxVid;delete t.dataset.cxVid,u&&"function"==typeof e.formFuns[u]&&(t.removeEventListener("submit",e.formFuns[u]),delete e.formFuns[u])},t}));
